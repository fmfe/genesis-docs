## åŸºäº Vue CSR çš„å¾®å‰ç«¯å®ç°æ–¹æ¡ˆ
åœ¨è¿™é‡Œå°±ä¸è®²å¾®å‰ç«¯çš„å„ç§ä¼˜ç¼ºç‚¹ï¼Œç›´æ¥å‡è®¾ä½ åœ¨è´Ÿè´£ä¸€ä¸ªä¸­åå°ç®¡ç†ç³»ç»Ÿçš„å¼€å‘ï¼Œæ‰€æœ‰çš„ä¸šåŠ¡æ¨¡å—å…¨éƒ¨éƒ½åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­æ‰“åŒ…ï¼Œéšç€ä¸šåŠ¡é‡çš„ä¸æ–­å¢é•¿ï¼Œç¼–è¯‘è¶Šæ¥è¶Šæ…¢ï¼Œä½ æœŸæœ›å¯ä»¥ä»è€çš„é¡¹ç›®ä¸­å°†æ–°çš„ä¸šåŠ¡è¿›è¡Œç‹¬ç«‹å¼€å‘ã€ç‹¬ç«‹éƒ¨ç½²ï¼Œä»¥å¾®åº”ç”¨çš„å½¢å¼åµŒå…¥åˆ°è€é¡¹ç›®ä¸­ã€‚

æœ¬ç¯‡æ–‡ç« çš„å—ä¼—æ˜¯é‚£äº›å¸Œæœ›åœ¨æ–°è€çš„é¡¹ç›®ä¸­ï¼Œåœ¨ä¸éœ€è¦ä½ å¯¹è€é¡¹ç›®è¿›è¡Œæ”¹åŠ¨è€é¡¹ç›®çš„å‰æä¸‹ï¼ŒåµŒå…¥å¾®åº”ç”¨ï¼Œå¦‚æœæœ¬ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç‚¹ä¸ªğŸ‘ï¼

## æ ¸å¿ƒè¦ç´ 
- æ„å»ºç”Ÿäº§ç¯å¢ƒä»£ç ï¼Œè¾“å‡ºè¿œç¨‹ç»„ä»¶æ‰€éœ€çš„ JSON 
- é€šè¿‡ ajax è¯·æ±‚ï¼Œæ‹¿åˆ°è¿™ä¸ª JSON çš„æ•°æ®ï¼Œä¼ ç»™ è¿œç¨‹ç»„ä»¶

## æ–°é¡¹ç›®çš„æ­å»º
å¯¹äºé¡¹ç›®çš„æ­å»ºï¼Œåœ¨è¿™é‡Œå°±ä¸å†ä»”ç»†çš„å±•å¼€è®²äº†ï¼Œå¤§å®¶ç›´æ¥çœ‹[Genesis](https://fmfe.github.io/genesis-docs/guide/#%E5%AE%89%E8%A3%85)é¡¹ç›®å¿«é€Ÿå¼€å§‹çš„æ–‡æ¡£å§

## ä¿®æ”¹ç¼–è¯‘ä»£ç 
```ts
import path from 'path';
import fs from 'fs';
import { Build } from '@fmfe/genesis-compiler';
import { ssr } from './genesis';

const start = async () => {
    /**
     * åˆ›å»ºä¸€ä¸ªç¼–è¯‘å®ä¾‹
     */
    const build = new Build(ssr);
    /**
     * å¼€å§‹æ‰§è¡Œç¼–è¯‘ç¨‹åºï¼Œæ„å»ºç”Ÿäº§ç¯å¢ƒåº”ç”¨åŒ…
     */
    await build.start();
    /**
     * ç¼–è¯‘å®Œæˆåï¼Œåˆ›å»ºä¸€ä¸ªæ¸²æŸ“å™¨ï¼Œè¾“å‡ºè¿œç¨‹ç»„ä»¶æ‰€éœ€çš„å†…å®¹
     */
    const renderer = ssr.createRenderer();
    /**
     * CSR æ¸²æŸ“è¾“å‡º JSON
     */
    const result = await renderer.render({ mode: 'csr-json' });
    /**
     * å°† JSON ä¿å­˜åˆ°å®¢æˆ·ç«¯ç›®å½•
     */
    fs.writeFileSync(
        path.resolve(ssr.outputDirInClient, 'app.json'),
        JSON.stringify(result.data, null, 4),
        'utf8'
    );
};
start();

```
å¦‚æœä½ æ˜¯æ ¹æ®å®˜æ–¹æ–‡æ¡£æ¥èµ°çš„è¯ï¼Œä½ åªéœ€è¦è‡ªå·±ä¿®æ”¹ä¸€ä¸‹ `genesis.build.ts` æ–‡ä»¶å³å¯ã€‚å¦‚æœä½ è‡ªå®šä¹‰äº†æ–‡ä»¶åï¼Œåªè¦åœ¨ `await build.start()` æ–¹æ³•æ‰§è¡Œå®Œæˆåï¼Œåˆ›å»ºä¸€ä¸ªæ¸²æŸ“å™¨ï¼Œå°† CSR çš„æ¸²æŸ“ç»“æœä¿å­˜åˆ°ä¸€ä¸ª JSON æ–‡ä»¶å³å¯ã€‚

ç¼–è¯‘å®Œæˆåï¼Œä½ å¾—åˆ°çš„å¤§æ¦‚æ˜¯è¿™æ ·çš„ä¸€ä¸ªæ–‡ä»¶
![](./images/20200525210729.jpg)
ä½ åªéœ€è¦å°† `client` ç›®å½•çš„é™æ€æ–‡ä»¶éƒ¨ç½²åˆ°ä½ çš„æœåŠ¡å™¨å³å¯ã€‚

## è€é¡¹ç›®è¿œç¨‹ç»„ä»¶åŠ è½½
å‡è®¾ä½ çš„é™æ€èµ„æºçš„åŸºæœ¬è·¯å¾„æ˜¯ `/ssr-genesis/`ï¼Œé‚£ä¹ˆä½ å°±å¯ä»¥é€šè¿‡ `/ssr-genesis/app.json` è®¿é—®åˆ°è¿™ä¸ªæ–‡ä»¶ã€‚

åœ¨ä½ çš„è€é¡¹ç›®ä¸Šå®‰è£…è¿œç¨‹ç»„ä»¶
```bash
npm install @fmfe/genesis-remote axios
```
åœ¨ä½ å¯¹åº”çš„è·¯ç”±ä¸Šï¼Œä½¿ç”¨è¿œç¨‹ç»„ä»¶ï¼ŒåŠ è½½æ­¤ç»„ä»¶å³å¯ã€‚
```vue
<template>
    <div class="app">
        <RemoteView :fetch="fetch" />
    </div>
</template>
<script lang="ts">
import Vue from 'vue';
import axios from 'axios';
import { RemoteView } from '@fmfe/genesis-remote';

export default Vue.extend({
    components: {
        RemoteView
    },
    methods: {
        async fetch() {
            const res = await axios.get('/ssr-genesis/app.json');
            if (res.status === 200) {
                return res.data;
            }
            return null;
        }
    }
});
</script>
```

## å¤šå†å²æ¨¡å¼çš„æ”¯æŒ
å¦‚æœä½ è€é¡¹ç›®ä½¿ç”¨å†å²æ¨¡å¼ï¼Œåœ¨å­åº”ç”¨ä¹Ÿä½¿ç”¨å†å²æ¨¡å¼ï¼Œä¼šå¯¼è‡´ `router.push('/xxx')` äº§ç”Ÿå¤šæ¡å†å²è®°å½•ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½ å¯ä»¥åœ¨å­åº”ç”¨ä½¿ç”¨ `abstract` æ¨¡å¼ï¼Œæˆ–è€…ä½¿ç”¨ [@fmfe/genesis-app](http://localhost:8080/genesis-docs/app/#%E5%AE%89%E8%A3%85) å¸®ä½ å¤„ç†å¤šä¸ª Router å®ä¾‹ä½¿ç”¨å†å²æ¨¡å¼äº§ç”Ÿçš„BUGï¼Œæ³¨æ„ï¼Œä½ éœ€è¦åœ¨æ–°è€é¡¹ç›®ä¸€èµ·ä½¿ç”¨ [@fmfe/genesis-app](http://localhost:8080/genesis-docs/app/#%E5%AE%89%E8%A3%85) åŒ…è£…åçš„ Router 

## æ‹“å±•
```ts
/**
 * CSR æ¸²æŸ“è¾“å‡º HTML
 */
const result = await renderer.render({ mode: 'csr-html' });
/**
 * å°† html ä¿å­˜åˆ°å®¢æˆ·ç«¯ç›®å½•
 */
fs.writeFileSync(
    path.resolve(ssr.outputDirInClient, 'index.html'),
    result.data
    'utf8'
);
```
å¦‚æœä½ ä»…ä»…åªæ˜¯æƒ³åš CSR çš„é¡¹ç›®ï¼Œåªéœ€è¦æ¸²æŸ“å‡º html å³å¯ï¼Œå’Œå¹³å¸¸çš„ CSR é¡¹ç›®ä¸€æ ·ï¼Œå°† `client` ç›®å½•éƒ¨ç½²åˆ°æœåŠ¡å™¨ã€‚


## æ€»ç»“
[Genesis](https://github.com/fmfe/genesis) åªæ˜¯ä¸€ä¸ª Vue SSR çš„æ¸²æŸ“åº“ï¼Œå®ƒä¸æ˜¯æ¡†æ¶ï¼Œå®ƒåªæ˜¯ç»™ä½ æä¾›äº†æœ€åŸºç¡€çš„ SSR æ¸²æŸ“èƒ½åŠ›ã€‚